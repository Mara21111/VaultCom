<app-base-ui
  [title]="'Friends'"
  [titleOn]="true"
  [closeOn]="true"
  [closeRoute]="'/main'">
</app-base-ui>

<div class="main-container">
  <div class="add-user-bar">
    <input
      [(ngModel)]="newFriendUsername"
      placeholder="Insert username"
      type="text"
    />
    <button (click)="addFriend()">Add</button>
  </div>

  <div class="friends-container">
    <div class="content-area">

      <!-- Friend Requests -->
      <section class="panel friends-panel" [class.active]="isSectionOpen.requests" *ngIf="Requests.length !== 0">
        <div class="clickable-header" (click)="toggleSection('requests')">
          <div class="section-title">
            Friend Requests
            <span class="arrow" [class.open]="isSectionOpen.requests">
              <svg width="16" height="16" viewBox="0 0 24 24">
                <path d="M8 5l8 7-8 7" fill="none" stroke="white" stroke-width="2" />
              </svg>
            </span>
          </div>
        </div>
        <div class="collapsible-content" [class.open]="isSectionOpen.requests">
          <div class="table-header">
            <div class="col-header">Username</div>
            <div class="col-header">Bio</div>
            <div class="col-header">Actions</div>
          </div>
          <div class="table-body">
            <div class="table-row" *ngFor="let user of Requests">
              <div class="col" (click)="goToUser(user.id)">
                {{ user?.username }}
              </div>
              <div class="col">{{ user?.bio }}</div>
              <div class="col action-buttons">
                <button class="btn btn-success" (click)="acceptRequest(user.id)">Accept</button>
                <button class="btn btn-danger" (click)="rejectRequest(user.id)">Reject</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Your Friends -->
      <section class="panel friends-panel" [class.active]="isSectionOpen.friends">
        <div class="clickable-header" (click)="toggleSection('friends')">
          <div class="section-title">
            Your Friends
            <span class="arrow" [class.open]="isSectionOpen.friends">
              <svg width="16" height="16" viewBox="0 0 24 24">
                <path d="M8 5l8 7-8 7" fill="none" stroke="white" stroke-width="2" />
              </svg>
            </span>
          </div>
        </div>
        <div class="collapsible-content" [class.open]="isSectionOpen.friends">
          <div class="table-header">
            <div class="col-header">Username</div>
            <div class="col-header">Bio</div>
            <div class="col-header">Nickname</div>
          </div>
          <div class="table-body">
            <div class="table-row" *ngFor="let friend of Friends" (click)="goToUser(friend.id)">
              <div class="col">{{ friend?.username }}</div>
              <div class="col">{{ friend?.bio }}</div>
              <div class="col">Nickname Here</div>
            </div>
          </div>
        </div>
      </section>

      <div *ngIf="isLoading" class="loading-overlay">
        <div class="spinner"></div>
      </div>

    </div>
  </div>
</div>

<app-side-panel
  *ngIf="PanelVisible"
  (close)="closePanel()"
  [user]="SelectedUser"
  [showActionButtons]="true">
</app-side-panel>

<div class="popup-backdrop" *ngIf="ShowPopup">
  <div class="popup">
    <p>{{ PopupMessage }}</p>
    <button (click)="closePopup()">Close</button>
  </div>
</div>
